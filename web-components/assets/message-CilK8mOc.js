import{n as m,t as Q}from"./property-C_111YFZ.js";import{i as ee,s as te,x as n}from"./lit-element-in3Y6axH.js";import{s as R}from"./settings-BQP9c3yA.js";import{r as d}from"./state-B7rdIQBm.js";import{s as se}from"./16-BiKbO_JJ.js";import{s as I}from"./16-D2pp6-dP.js";import{b as v}from"./directive-Bp-AemGL.js";import{s as k}from"./spread-O99WNTpv.js";import{s as D,a as A}from"./16-BnEwBFTF.js";import"./popupElement-CfVwostK.js";import"./chartElement-dhtR9X5r.js";import"./tableElement-C1_amUWF.js";import"./cardElement-pVx9BoiA.js";import"./codeElement-B5MofQda.js";import"./tagListElement-DQZ-rnHw.js";import"./listElement-Cxams1jl.js";import"./carouselElement-DbZhHDHD.js";import"./imageElement-CIW-N3Bx.js";import"./editableTextElement-B-Ta2_P0.js";import"./errorElement-DFQMAYMm.js";import"./loadingElement-B61A2AFv.js";import"./linkListElement-CAaggUPN.js";import"./molecularElement-DkWESa3v.js";import"./formulaElement-BC6XACAu.js";import"./fileUploadElement-OnYOZJVo.js";import"./diagramElement-CXrEOhUe.js";const ae=ee`:host(clabs-chat-message){position:relative;display:block;border-radius:10px;font-family:IBM Plex Sans,sans-serif;font-size:14px;padding-block:0 12px;padding-inline:16px 24px}:host(clabs-chat-message) .clabs--chat-message-container{position:relative;display:inline-flex;inline-size:100%}:host(clabs-chat-message) .clabs--chat-message-user-message{color:var(--cds-text-primary, #161616)}:host(clabs-chat-message) .clabs--chat-message-content{overflow:hidden;box-sizing:border-box;border-inline-start:1px solid var(--chat-message-unique-display-color, none);inline-size:100%;max-inline-size:100%;padding-inline-start:16px}:host(clabs-chat-message) .clabs--chat-message-hidden-label{position:absolute;overflow:hidden;padding:0;border:0;margin:-1px;block-size:1px;clip:rect(0,0,0,0);inline-size:1px;white-space:nowrap}:host(clabs-chat-message) .clabs--chat-message-content-compact{padding-inline-start:8px}:host(clabs-chat-message) .clabs--chat-message-section-temporary{margin-block:16px 4px;margin-block-end:64px;min-block-size:156px}:host(clabs-chat-message) .clabs--chat-message-warning{padding:10px;color:var(--cds-support-error, #da1e28);font-style:italic;line-height:22px}:host(clabs-chat-message) .clabs--chat-message-user-icon{display:none}:host(clabs-chat-message) .clabs--chat-message-timestamp-user{clear:both;color:var(--cds-text-secondary, #525252);float:inline-end;font-size:12px;padding-block-end:12px}:host(clabs-chat-message) .clabs--chat-message-response-user{padding:6px 16px;background:var(--cds-layer-accent-01, #e0e0e0);border-end-end-radius:8px;border-end-start-radius:8px;border-start-start-radius:8px;clear:both;float:inline-end;max-inline-size:65%}:host(clabs-chat-message) .clabs--chat-message-dropdown-user{clear:both;float:inline-end;min-block-size:16px;padding-block-start:8px}:host(clabs-chat-message) .clabs--chat-message-bot-message{color:var(--chat-message-unique-display-color, var(--cds-text-primary, #161616))}:host(clabs-chat-message) .clabs--chat-message-bot-icon{display:flex;align-items:center;justify-content:center;block-size:32px;inline-size:32px}:host(clabs-chat-message) .clabs--chat-message-header-bot-compact{position:relative;display:flex;flex-direction:column;padding-block:8px 16px}:host(clabs-chat-message) .clabs--chat-message-bot-icon-compact{block-size:32px;inline-size:32px;inset-inline-start:-2px}:host(clabs-chat-message) .clabs--chat-message-timestamp-bot-compact{color:var(--cds-text-secondary, #525252);font-size:12px;padding-block-start:12px}:host(clabs-chat-message) .clabs--chat-message-agent-icon{display:flex;align-items:center;justify-content:center;block-size:32px;color:var(--chat-message-unique-display-color, var(--cds-text-primary, #161616));fill:var(--chat-message-unique-display-color, var(--cds-text-primary, #161616));inline-size:42px;opacity:1}:host(clabs-chat-message) .clabs--chat-message-agent-icon svg{fill:var(--chat-message-unique-display-color, var(--cds-text-primary, #161616))}:host(clabs-chat-message) .clabs--chat-message-timestamp-bot{display:flex;flex-direction:row;align-items:center;block-size:32px;color:var(--chat-message-unique-display-color, var(--cds-text-secondary, #525252));font-size:12px;gap:16px}:host(clabs-chat-message) .clabs--chat-message-response-bot{display:flex;box-sizing:border-box;flex-direction:column;gap:16px;inline-size:100%;max-inline-size:100%}:host(clabs-chat-message) .clabs--chat-message-streaming{padding-block-end:64px}:host(clabs-chat-message) .clabs--chat-message-dropdown-bot{inline-size:100%;min-block-size:16px;padding-block-start:8px}:host(clabs-chat-message) .clabs--chat-message-small-button{display:inline-block;align-items:center;justify-content:center;padding:6px;background:none;color:var(--cds-text-primary, #161616);cursor:pointer}:host(clabs-chat-message) .clabs--chat-message-small-button svg{color:var(--cds-text-primary, #161616);fill:var(--cds-text-primary, #161616)}:host(clabs-chat-message) .clabs--chat-message-small-button svg:hover{fill:var(--cds-link-primary, #0f62fe)}:host(clabs-chat-message) .clabs--chat-avatar-element-light-0{fill:#fff;stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-light-1{fill:url(#ik7o2yqk8a);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-light-2{fill:url(#9hg0dg6llb);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-light-3{fill:url(#q1snp4vndc);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-light-4{stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-light-5{mask:url(#eelbk9r8md)}:host(clabs-chat-message) .clabs--chat-avatar-element-light-6{fill:url(#8ak2l80n4e);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-light-7{fill:#001d6c;stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-0{fill:#fff;stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-1{fill:url(#8913t7g6za);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-2{fill:url(#woevpxiuib);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-3{fill:url(#je2bg9iagc);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-4{stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-5{mask:url(#brch21jdod)}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-6{fill:url(#2co5q30b1e);stroke-width:0}:host(clabs-chat-message) .clabs--chat-avatar-element-dark-7{fill:#f4f4f4;stroke-width:0}`;var ie=Object.defineProperty,h=(g,t,e,s)=>{for(var a=void 0,c=g.length-1,o;c>=0;c--)(o=g[c])&&(a=o(t,e,a)||a);return a&&ie(t,e,a),a};const{stablePrefix:H}=R,F=class F extends te{constructor(){super(...arguments),this._messageElements=[],this._editedMessage="",this.showFeedBackForm=!1,this._editing=!1,this._forceStreamEnd=!1,this.temporaryMessage={content:"",type:"text"},this.streamingIndex=0,this.tokens=[],this.currentlyStreaming=!1,this.bufferMessage="",this.currentType="",this.baseStreamingSpeed=6,this.positiveFeedbackSelected=!1,this.negativeFeedbackSelected=!1,this._feedbackFormOrientation="top",this._renderLabel=t=>{let e;const s=this.customLabels||{};if(s)switch(t){case"message-regenerate-button":e=s[t]||"Regenerate";break;case"message-like-button":e=s[t]||"Thumbs up";break;case"message-undo-like-button":e=s[t]||"Remove thumbs up";break;case"message-dislike-button":e=s[t]||"Thumbs down";break;case"message-undo-dislike-button":e=s[t]||"Remove thumbs down";break;case"message-enable-editing":e=s[t]||"Edit";break;case"message-undo-edit":e=s[t]||"Undo edit";break;case"message-validate-edit":e=s[t]||"Validate edit";break;case"message-loading-aria-label":e=s[t]||"Message sent, please wait...";break}return e||t}}firstUpdated(){if(this._getTheme(),this.hasAttribute("display-color")&&this.style.setProperty("--chat-message-unique-display-color",this.displayColor),this.loadingState){this._messageElements=[{content:"",type:"loading"}];return}if(this.errorState){this._messageElements=[{content:this.rawText,type:"error"}];return}this.elements==null?this.userSubmitted?this.rawText&&this._parseText():this._streamContent?this._streamText():this.rawText:this._messageElements=this.elements}_prepareReaderText(t){var p;let e="";if(t.length==1&&((p=t[0])==null?void 0:p.type)==="loading")return this._renderLabel("message-loading-aria-label");e=t.map(b=>b.content).join(`
`);const s="<[^>]*>",a="<(script|style)[^>]*>[\\s\\S]*?<\\/\\1>";return e.replace(new RegExp(a,"gi"),"").replace(new RegExp(s,"g"),"").trim()}updated(t){if(super.updated(t),t.has("bufferMessage")){const e=new CustomEvent("on-structure-change",{detail:{action:"message: internal change"},bubbles:!0,composed:!0});this.dispatchEvent(e)}t.has("_streamContent")&&(this._forceStreamEnd=!this._streamContent),t.has("rawText")&&(this._streamContent||this._parseText()),t.has("_messageElements")&&(this._readerContent=this._prepareReaderText(this._messageElements)),t.has("compactIcon")&&(this.showFeedBackForm=!1),t.has("_readerContent")&&setTimeout(()=>{},200)}_getTheme(){if(this.parentElement instanceof HTMLElement){const e=getComputedStyle(this.parentElement).getPropertyValue("--cds-background");let s=!1;e.startsWith("#")&&parseInt(e.replace("#",""),16)<16777215/2&&(s=!0),this._parentTheme=s?"g100":"white"}}_handleSlotchange(t){const e=this._prepareEventDetail();e.action="message: slotted content added",t.preventDefault();const s=new CustomEvent("on-message-element-slot-update",{detail:e,bubbles:!0,composed:!0});this.dispatchEvent(s)}_checkForCode(t){const s=t.split("```"),a=[];for(let c=0;c<s.length;c++){const o=s[c].trim();c%2===0?o.length>0&&a.push({content:o,type:"text"}):o.length>0&&a.push({content:o,type:"code"})}return a}_hideFeedBackForm(){this.showFeedBackForm=!1}generateUniqueId(){return Math.random().toString(36).substr(2,9)}_handleDisplayFeedBackForm(t,e,s){var o,p;const a=t.target;this.popupTargetElement=a,t.preventDefault();const c=(p=(o=this.parentElement)==null?void 0:o.parentElement)==null?void 0:p.scrollHeight;this.feedbackFormDefinitions&&(this._feedbackFormValues=this.feedbackFormDefinitions[e],this._feedbackFormValues.uniqueFeedbackId=this.uniqueFeedbackId,this._feedbackFormValues.parentValues={offsetTop:this.offsetTop,scrollHeight:c,uniqueId:s}),this.showFeedBackForm=!0}_prepareEventDetail(){const t="not-specified";return{messageOrigin:this.origin?this.origin:t,messageTime:this.timeStamp?this.timeStamp:t,displayName:this.displayName?this.displayName:t,messageIndexInChat:this.index}}_onTagSelected(t){const e=this._prepareEventDetail(),s=t.tagContent;e.action="message: tag in tag list element clicked",e.selectedTagContent=s,t.preventDefault();const a=new CustomEvent("on-message-element-tag-selected",{detail:e,bubbles:!0,composed:!0});this.dispatchEvent(a)}_childLinkClicked(t){const e=this._prepareEventDetail();e.action="message: link-sub-element in message clicked",e.event=t,e.selectedURL=t.detail.selectedURL,e.selectedTitle=t.detail.selectedTitle;const s=new CustomEvent("on-message-link-list-item-click",{detail:e,bubbles:!0,composed:!0});this.dispatchEvent(s)}_handleMessageElementClick(t){const e=this._prepareEventDetail();e.action="message: sub-element in message clicked",e.event=t,t.preventDefault();const s=new CustomEvent("on-message-element-selected",{detail:e,bubbles:!0,composed:!0});this.dispatchEvent(s)}_checkStreamForBlocks(){let t;return this.currentType?t=this._checkBlockEnd():t=this._checkBlockStart(),t}_checkBlockType(t){const e={code:new RegExp("```"),json:new RegExp("\\{"),table:new RegExp("((\\w+,\\w+)(,[\\w+]*)*[\\r\\n]+)+"),array:new RegExp("(?<!\\))\\["),url:new RegExp("(http|ftp)"),list:new RegExp("(?:\\d+\\.\\s+|[-*]\\s)")};for(const s in e){const a=t.match(e[s]);if(a&&(a.index?a.index:-1)>-1)return s}return"text"}_checkBlockStart(){const t=["code","json","formula","table","array","molecule","url","list"],e={code:new RegExp("```"),json:new RegExp("\\{"),table:new RegExp("((\\w+,\\w+)(,[\\w+]*)*[\\r\\n]+)+"),array:new RegExp('\\[\\"'),formula:new RegExp("\\\\\\("),annotation:new RegExp("\\(.*?\\)\\[.*?\\]"),url:new RegExp("(?<!\\(|,)\\b(http|ftp)\\S+"),list:new RegExp("(?:1\\.\\s+[-*]\\s|\\d{2,}\\.\\s+[-*]\\s)")};for(const s of t){const a=this.bufferMessage.match(e[s]);if(a){const c=a.index?a.index:-1;if(c>-1){const o=this.bufferMessage.substring(0,c),p=this.bufferMessage.substring(c);return this.bufferMessage=p,{status:"started",type:s,content:this.bufferMessage,preBlockText:o}}}}return{status:"",type:"",content:"",preBlockText:""}}_checkBlockEnd(){let t=-1;switch(this.currentType){case"code":{t=this.bufferMessage.indexOf("```",3),t!==-1&&(t+=3);break}case"chart":case"json":{let e=0;for(let s=0;s<this.bufferMessage.length;s++){const a=this.bufferMessage[s];a==="{"&&e++,a==="}"&&(e--,t=s)}e!==0&&(t=-1);break}case"array":case"tags":case"carousel":t=this.bufferMessage.indexOf("]");break;case"annotation":t=this.bufferMessage.indexOf(")");break;case"molecule":case"formula":case"url":t=this.bufferMessage.indexOf(`
`);break;case"table":{const e=this.bufferMessage.split(`
`);let s=0,a=0,c=9;for(const o of e){if(!new RegExp("^[\\w\\s]+(,[\\w\\s]+)*$").test(o)&&(a++,a>1)){t=s-c;break}c=o.length+1,s+=c}break}case"list":{let e=0,s=0,a=0;const c=this.bufferMessage.split(`
`);for(const o of c){if(!new RegExp("\\s*(?:[-*\\u2022\\u25E6\\u25AA\\u25CF]\\s|\\d+\\.\\s)").test(o)&&(e++,e>1)){t=s-a;break}a=o.length+1,s+=a}break}}if(t!==null&&t!==-1){(this.currentType==="array"||this.currentType==="carousel"||this.currentType==="tags"||this.currentType==="chart"||this.currentType==="json")&&t++,this.currentType==="table"&&t--;const e=this.bufferMessage.substring(0,t);this.bufferMessage=this.bufferMessage.substring(t);let s=this.currentType;if(s==="array")try{JSON.parse(e),s="carousel"}catch{s="tags"}return s==="json"&&(this.bufferMessage.indexOf("$schema")>-1?s="chart":s="code"),{status:"ended",type:s,content:e,preBlockText:""}}return{status:"incomplete",type:this.currentType,content:this.bufferMessage,preBlockText:""}}_checkAmbiguousBlock(){if(this.currentType==="code"&&new RegExp("^[CNOSPFIBrcln=#$%@\\-+\\[\\]()\\/0-9]+$").test(this.bufferMessage.replace("```",""))&&(this.currentType="molecule",this.temporaryMessage.type="molecule"),this.currentType==="json"&&this.bufferMessage.indexOf("$schema")>-1&&(this.currentType="chart",this.temporaryMessage.type="chart"),this.currentType==="array"){const t=new RegExp("(https?:\\/\\/[^\\s]+)","g"),e=this.bufferMessage.replace("[","").replace(new RegExp(",\\s*$"),"").split(",");e.length>1&&(t.test(e[0])?(this.temporaryMessage.type="carousel",this.currentType="carousel"):(this.temporaryMessage.type="tags",this.currentType="tags"))}}_streamText(){console.log("streaming..."),this.currentlyStreaming=!0,this.tokens=this._tokenize(this.rawText),this.bufferMessage="",this.temporaryMessage={content:"",type:"text"},this.currentType="",this.baseStreamingSpeed=this._streamDelay||this.baseStreamingSpeed,this._beginStreaming()}_beginStreaming(){this.streamingInterval!==null&&clearInterval(this.streamingInterval),this.streamingInterval=setTimeout(()=>{const t=this.tokens[this.streamingIndex]||"";this.streamingIndex++,this.bufferMessage+=t;const e=this._checkStreamForBlocks();if(e)if(e.type!==""){if(e.status==="started"&&(this.currentType=e.type,this.temporaryMessage.content=this.bufferMessage,e.type==="url"?this.temporaryMessage.type="text":e.type==="json"?this.temporaryMessage.type="code":e.type==="array"?this.temporaryMessage.type="text":this.temporaryMessage.type=e.type,e.preBlockText.length>0&&e.preBlockText.trim()!==""&&this._cutPlainText(e.preBlockText.trim())),e.status==="incomplete"&&(this._checkAmbiguousBlock(),this.temporaryMessage.content=this.bufferMessage,e.type==="text")){const s=e.content.split(`
`);if(s.length>0)for(let a=0;a<s.length-1;a++){const c=s[a];this._messageElements=[...this._messageElements,{content:c,type:"text"}],this.bufferMessage=s[s.length]}}e.status==="ended"&&(this.currentType="",this.temporaryMessage.type="text",e.type==="url"&&(e.type=this._checkURLType(e.content)),e.type==="text"?this._cutPlainText(e.content):this._messageElements=[...this._messageElements,{content:e.content,type:e.type}])}else this.temporaryMessage.content=this.bufferMessage,this.temporaryMessage.type="text";else this.temporaryMessage.content=this.bufferMessage,this.temporaryMessage.type="text";switch(this.streamingSpeed=this.baseStreamingSpeed+Math.random()*Math.random()*Math.random()*this.baseStreamingSpeed*5,this.temporaryMessage.type){case"code":this.streamingSpeed=this.baseStreamingSpeed/1;break;case"table":this.streamingSpeed=this.baseStreamingSpeed/1;break;case"carousel":this.streamingSpeed=this.baseStreamingSpeed/1;break;case"json":case"chart":this.streamingSpeed=this.baseStreamingSpeed/4;break;case"molecule":this.streamingSpeed=this.baseStreamingSpeed*4;break;case"text":this.streamingSpeed=this.baseStreamingSpeed;break}if(this.streamingSpeed=Math.max(1,this.streamingSpeed),this.streamingIndex>=this.tokens.length||this._forceStreamEnd)if(this.currentlyStreaming)this.currentlyStreaming=!1,this._beginStreaming();else{if(this.temporaryMessage.content.length>0){const s=this.temporaryMessage.content,a=s.trim().split(`
`),c=a.pop(),o=this._checkBlockType(c);o!==this.temporaryMessage.type?(this._messageElements=[...this._messageElements,{content:a.join(`
`).replace(/\.\.\.$/,""),type:this.temporaryMessage.type}],this._messageElements=[...this._messageElements,{content:c,type:o}]):this._messageElements=[...this._messageElements,{content:s.replace(/\.\.\.$/,""),type:this.temporaryMessage.type}]}this.temporaryMessage.content="",this.streamingIndex=0,this._signalEndOfStreaming()}else this._beginStreaming()},this.streamingSpeed)}_cutPlainText(t){const s=t.split(`
`).map(a=>({content:a,type:this._checkLinks(a)?"link-list":"text"}));this._messageElements=[...this._messageElements,...s]}_checkLinks(t){return new RegExp("^\\[.*?\\]\\(.*?\\)(,\\[.*?\\]\\(.*?\\))*$").test(t.trim())}_signalEndOfStreaming(){const t=new CustomEvent("on-message-streaming-done",{detail:{action:"message component reported end of streaming"},bubbles:!0,composed:!0});this.dispatchEvent(t)}_tokenize(t){const e=new RegExp("(\\s|,|#|\\{|\\}|\"|\\[|\\]|%|'|\\n|\\t|\\/|\\.|_|<|>|:|-|\\(|\\)|\\?|\\||@|&|\\*|\\+|=|;|\\`|~)");return t.split(e)}_parseText(){this.tokens=this._tokenize(this.rawText),this.currentType="",this.bufferMessage="";for(const t of this.tokens){this.bufferMessage+=t;const e=this._checkStreamForBlocks();e&&e.type!==""&&(e.status==="started"&&(this.currentType=e.type,e.preBlockText.length>0&&e.preBlockText.trim()!==""&&(this._messageElements=[...this._messageElements,{content:e.preBlockText,type:"text"}])),e.status==="incomplete"&&this._checkAmbiguousBlock(),e.status==="ended"&&(this.currentType="",e.type==="url"&&(e.type=this._checkURLType(e.content)),this._messageElements=[...this._messageElements,{content:e.content,type:e.type}])),this.streamingIndex++,this.streamingIndex===this.tokens.length&&this.bufferMessage&&(this._messageElements=[...this._messageElements,{content:this.bufferMessage,type:"text"}])}}_parseTextOld(){const t=this.rawText,e=[],s=this._checkForCode(t);if(s.length==0||t=="undefined")e.push({content:"Model reply received but was undefined.",type:"error"});else for(const a of s)if(a.type=="code")e.push(a);else{const c=this._checkForObjects(a.content);for(const o of c)if(o.type!=="non-object")e.push(o);else{const p=this._checkForURLs(o.content);for(const b of p)if(b.type=="text"){const y=this._checkForFormatting(b.content);for(const[$,w]of y.entries())y.length-1,e.push(w)}else e.push(b)}}this._messageElements=e}_checkForObjects(t){const e=[],s=t.split(`
`);let a=[];for(const c of s)try{const o=JSON.parse(c),p=this._checkObjectType(o);p==="multi-url"?e.concat(o.map(b=>({content:b,type:"url"}))):e.push({type:p,content:c}),a.length>0&&(e.push({type:"non-object",content:a.join(`
`)}),a=[])}catch{a.push(c)}return a.length>0&&(e.push({type:"non-object",content:a.join(`
`)}),a=[]),e}_checkObjectType(t){let e="code";if(Array.isArray(t)){const s=new RegExp("(https?://[^\\s]+)","g"),a=new RegExp("\\.(png|jpg|jpeg|gif|svg)$","i"),c=t.every(p=>a.test(p)&&typeof p=="string"),o=t.every(p=>s.test(p)&&typeof p=="string");c?e="carousel":o?e="multi-url":e="tags"}else"$schema"in t?e="chart":e="code";return e}_checkURLType(t){const e=new RegExp("\\.(png|jpg|jpeg|gif|svg|bmp|webp|ico|tiff|tif)$","i"),s=new RegExp("\\.(mp4|avi|flv|mkv|mov|webm|m4v|ogv)$","i"),a=new RegExp("\\.(pdf|doc|docx|csv|xls|xlsx|ppt|pptx|txt|rtf|xml|odt|zip|rar|tar|gz)$","i"),c=new RegExp("\\.(mp3|flac|wav|ogg|mpa|wma|midi)$","i"),o=new RegExp("(https?:\\/\\/[^\\s]+)","g");return e.test(t)?"img":s.test(t)?"video":c.test(t)?"audio":a.test(t)?"file":o.test(t)?"url":"text"}_checkForFormatting(t){const e=[],s=new RegExp("^(?:d+.|[•‣◦⁃-])"),a=t.split(`
`);let c="",o="";for(const p of a){const b=s.test(p)?"list":"text";c===""?(c=b,o+=p):b===c?o+=`
`+p:(e.push({type:c,content:o.trim()}),o=p,c=b)}return o!==""&&e.push({type:s.test(o)?"list":"text",content:o}),e}_checkForURLs(t){let e=[];const s=new RegExp("(https?:\\/\\/[^\\s]+)","g");return e=t.split(s).map(c=>({content:c,type:this._checkURLType(c)})),e}_handleEdit(){var c;const t=(c=this.shadowRoot)==null?void 0:c.querySelector("."+H+"--chat-message-response-user");let e=this.clientWidth;t instanceof HTMLElement&&(e=t.clientWidth),this._editing=!0;const s=this._prepareEventDetail();this.previousMessageWidth=e,s.action="MESSAGE: User started a message edit";const a=new CustomEvent("on-user-message-edit-request",{detail:s,bubbles:!0,composed:!0});this.dispatchEvent(a)}_setEditedMessage(t){this._editedMessage=t.detail.value}_cancelEdit(){this._editing=!1,this._editedMessage="";const t=this._prepareEventDetail();t.action="MESSAGE: User aborted a message edit";const e=new CustomEvent("on-user-message-cancellation-request",{detail:t,bubbles:!0,composed:!0});this.dispatchEvent(e)}_validateEdit(){this._editing=!1;const t=this._prepareEventDetail();t.action="message: user edited a previous query",t.newMessage=this._editedMessage,t.previousMessage=this.rawText,this.rawText=this._editedMessage,this._messageElements=[{content:this._editedMessage,type:"text"}];const e=new CustomEvent("on-user-message-update-request",{detail:t,bubbles:!0,composed:!0});this.dispatchEvent(e)}_handleRegenerate(t){const e=this._prepareEventDetail();e.action="message: user regenerated a chat response",e.messageElements=this._messageElements,t.preventDefault();const s=new CustomEvent("on-message-regeneration",{detail:e,bubbles:!0,composed:!0});this.dispatchEvent(s)}_handleMessageEditStart(t){const e=this._prepareEventDetail();e.action="message: user edited their message",e.messageElements=this._messageElements,t.preventDefault();const s=new CustomEvent("on-message-edit-start",{detail:e,bubbles:!0,composed:!0});this.dispatchEvent(s)}_handleMessageEditCancel(t){const e=this._prepareEventDetail();e.action="message: user canceled their message edit",e.messageElements=this._messageElements,t.preventDefault();const s=new CustomEvent("on-message-edit-cancel",{detail:e,bubbles:!0,composed:!0});this.dispatchEvent(s)}handlePositiveKeyboardInput(t){(t.key==="Enter"||t.key===" ")&&(this._handlePositiveFeedback(t),t.preventDefault())}handleNegativeKeyboardInput(t){(t.key==="Enter"||t.key===" ")&&(this._handleNegativeFeedback(t),t.preventDefault())}_focusOnPopup(){var s;const t=H+"--chat-popup-unique-feedback-"+this.index,e=(s=this.shadowRoot)==null?void 0:s.getElementById(t);e instanceof HTMLElement&&e.focus()}_handlePositiveFeedback(t){const e=this.generateUniqueId();this.positiveFeedbackSelected=!this.positiveFeedbackSelected,this.negativeFeedbackSelected=!1;const s=this._prepareEventDetail();this.positiveFeedbackSelected?(s.action="message: user gave feedback to response",this._focusOnPopup()):s.action="message: user removed feedback to response",s.type="positive",s.rawTextMessage=this.rawText,s.messageElements=this._messageElements,s.originalEvent=t,s.feedbackId=e,t.preventDefault();const a=new CustomEvent("on-user-feedback-request",{detail:s,bubbles:!0,composed:!0});this.dispatchEvent(a),this.positiveFeedbackSelected?this._handleDisplayFeedBackForm(t,"thumbs-up",e):this._hideFeedBackForm()}_handleNegativeFeedback(t){const e=this.generateUniqueId();this.positiveFeedbackSelected=!1,this.negativeFeedbackSelected=!this.negativeFeedbackSelected;const s=this._prepareEventDetail();this.negativeFeedbackSelected?(s.action="message: user gave feedback to response",this._focusOnPopup()):s.action="message: user removed feedback to response",s.type="negative",s.rawTextMessage=this.rawText,s.messageElements=this._messageElements,s.originalEvent=t,s.feedbackId=e,t.preventDefault();const a=new CustomEvent("on-user-feedback-request",{detail:s,bubbles:!0,composed:!0});this.dispatchEvent(a),this.negativeFeedbackSelected?this._handleDisplayFeedBackForm(t,"thumbs-down",e):this._hideFeedBackForm()}};F.styles=ae;let l=F;h([d()],l.prototype,"_messageElements");h([m({type:Boolean,attribute:"user-submitted"})],l.prototype,"userSubmitted");h([m({type:Array,attribute:"elements",reflect:!0})],l.prototype,"elements");h([m({type:String,attribute:"display-name"})],l.prototype,"displayName");h([m({type:Boolean,attribute:"disable-buttons"})],l.prototype,"disableButtons");h([m({type:String,attribute:"raw-text",reflect:!0})],l.prototype,"rawText");h([d()],l.prototype,"_editedMessage");h([m({type:String,attribute:"parent-theme"})],l.prototype,"_parentTheme");h([m({type:String,attribute:"origin"})],l.prototype,"origin");h([d()],l.prototype,"showFeedBackForm");h([m({type:String,attribute:"time-stamp"})],l.prototype,"timeStamp");h([m({type:Number,attribute:"index"})],l.prototype,"index");h([m({type:Boolean,attribute:"error-state"})],l.prototype,"errorState");h([m({type:Boolean,attribute:"loading-state",reflect:!0})],l.prototype,"loadingState");h([m({type:Boolean,attribute:"compact-icon"})],l.prototype,"compactIcon");h([m({type:Number,attribute:"stream-delay"})],l.prototype,"_streamDelay");h([d()],l.prototype,"_editing");h([m({type:String,attribute:"display-color",reflect:!0})],l.prototype,"displayColor");h([m({type:Boolean,attribute:"stream-content"})],l.prototype,"_streamContent");h([m({type:Boolean,attribute:"enable-complex-feedback"})],l.prototype,"enableComplexFeedback");h([d()],l.prototype,"_forceStreamEnd");h([d()],l.prototype,"temporaryMessage");h([d()],l.prototype,"streamingIndex");h([d()],l.prototype,"tokens");h([d()],l.prototype,"currentlyStreaming");h([d()],l.prototype,"bufferMessage");h([d()],l.prototype,"currentType");h([d()],l.prototype,"streamingInterval");h([d()],l.prototype,"streamingSpeed");h([d()],l.prototype,"baseStreamingSpeed");h([d()],l.prototype,"feedbackFormTarget");h([d()],l.prototype,"positiveFeedbackSelected");h([d()],l.prototype,"negativeFeedbackSelected");h([m({type:Object,attribute:"feedbackFormDefinitions"})],l.prototype,"feedbackFormDefinitions");h([d()],l.prototype,"_feedbackFormOrientation");h([d()],l.prototype,"_feedbackFormValues");h([d()],l.prototype,"popupTargetElement");h([d()],l.prototype,"uniqueFeedbackId");h([m({type:Object,attribute:"customLabels"})],l.prototype,"customLabels");h([d()],l.prototype,"_readerContent");h([d()],l.prototype,"previousMessageWidth");const ne=({children:g,...t}={})=>v`<svg focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" fill="currentColor" ...="${k(t)}" aria-hidden="true" width="16" height="16" viewBox="0 0 32 32">${g}<path d="M26,12H20V6a3.0033,3.0033,0,0,0-3-3H14.8672a2.0094,2.0094,0,0,0-1.98,1.7173l-.8453,5.9165L8.4648,16H2V30H23a7.0078,7.0078,0,0,0,7-7V16A4.0045,4.0045,0,0,0,26,12ZM8,28H4V18H8Zm20-5a5.0057,5.0057,0,0,1-5,5H10V17.3027l3.9578-5.9365L14.8672,5H17a1.0008,1.0008,0,0,1,1,1v8h8a2.0025,2.0025,0,0,1,2,2Z"></path></svg>`,ce=({children:g,...t}={})=>v`<svg focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" fill="currentColor" ...="${k(t)}" aria-hidden="true" width="16" height="16" viewBox="0 0 32 32">${g}<path d="M30,16V9a7.0078,7.0078,0,0,0-7-7H2V16H8.4648l3.5774,5.3662.8453,5.9165A2.0094,2.0094,0,0,0,14.8672,29H17a3.0033,3.0033,0,0,0,3-3V20h6A4.0045,4.0045,0,0,0,30,16ZM8,14H4V4H8Zm20,2a2.0025,2.0025,0,0,1-2,2H18v8a1.0008,1.0008,0,0,1-1,1H14.8672l-.9094-6.3662L10,14.6973V4H23a5.0057,5.0057,0,0,1,5,5Z"></path></svg>`,oe=({children:g,...t}={})=>v`<svg focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" fill="currentColor" ...="${k(t)}" aria-hidden="true" width="16" height="16" viewBox="0 0 32 32">${g}<path d="M2 16H7V30H2zM23 30H9V15.1973l3.0422-4.5635.8453-5.9165A2.0094 2.0094 0 0114.8672 3H15a3.0033 3.0033 0 013 3v6h8a4.0045 4.0045 0 014 4v7A7.0078 7.0078 0 0123 30z"></path></svg>`,re=({children:g,...t}={})=>v`<svg focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" fill="currentColor" ...="${k(t)}" aria-hidden="true" width="16" height="16" viewBox="0 0 32 32">${g}<path d="M2 2H7V16H2zM23 2H9V16.8027l3.0422 4.5635.8453 5.9165A2.0094 2.0094 0 0014.8672 29H15a3.0033 3.0033 0 003-3V20h8a4.0045 4.0045 0 004-4V9A7.0078 7.0078 0 0023 2z"></path></svg>`,le=({children:g,...t}={})=>v`<svg focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" fill="currentColor" ...="${k(t)}" aria-hidden="true" width="24" height="24" viewBox="0 0 32 32">${g}<path d="m26,24c-1.1046,0-2,.8954-2,2,0,.0764.0142.1488.0225.2229-2.2808,1.7963-5.0792,2.7771-8.0225,2.7771-2.7746,0-5.3432-.881-7.4566-2.3676.2576.0261.517.0444.7798.0444,4.2329,0,7.6768-3.4438,7.6768-7.6768h-2c0,3.1304-2.5464,5.6768-5.6768,5.6768-2.2111,0-4.1977-1.2816-5.1318-3.2725-.1365-.2972-.2595-.6007-.3738-.9094.6602.322,1.3998.5051,2.1824.5051,2.7568,0,5-2.2432,5-5v-2h-2v2c0,1.6543-1.3457,3-3,3s-3-1.3457-3-3c0-2.1152.4917-4.1328,1.4619-5.9956l-1.7744-.9238c-1.104,2.1211-1.6875,4.5137-1.6875,6.9194,0,8.271,6.729,15,15,15,3.3744,0,6.5818-1.1193,9.2048-3.1662.244.106.5123.1662.7952.1662,1.1046,0,2-.8954,2-2s-.8954-2-2-2Z"></path><path d="M21 21H23V23H21z" transform="rotate(90 22 22)"></path><path d="M15 15H17V17H15z" transform="rotate(90 16 16)"></path><path d="M9 9H11V11H9z" transform="rotate(-90 10 10)"></path><path d="m16,1c-3.3744,0-6.5818,1.1193-9.2048,3.1662-.244-.106-.5123-.1662-.7952-.1662-1.1046,0-2,.8954-2,2s.8954,2,2,2,2-.8954,2-2c0-.0764-.0142-.1488-.0225-.2229,2.2808-1.7963,5.0792-2.7771,8.0225-2.7771,2.7708,0,5.3363.8784,7.4481,2.3613-.249-.0242-.5005-.038-.7547-.038-4.2329,0-7.6768,3.4438-7.6768,7.6768h2c0-3.1304,2.5464-5.6768,5.6768-5.6768,2.0554,0,3.9068,1.0953,4.9186,2.8651.2153.4283.4053.8701.5729,1.3237-.6615-.3234-1.4005-.5121-2.1849-.5121-2.7568,0-5,2.2432-5,5v2h2v-2c0-1.6543,1.3457-3,3-3s3,1.3457,3,3c0,2.1152-.4917,4.1328-1.4619,5.9956l1.7744.9238c1.104-2.1211,1.6875-4.5137,1.6875-6.9194C31,7.729,24.271,1,16,1Z"></path></svg>`;/**
 * @license
 *
 * Copyright IBM Corp. 2023
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */const{stablePrefix:i}=R;function he(g){const{_messageElements:t,userSubmitted:e,timeStamp:s,loadingState:a,index:c,displayName:o,disableButtons:p,_editing:b,_handleEdit:y,_cancelEdit:$,_setEditedMessage:w,_validateEdit:C,_handlePositiveFeedback:q,_handleNegativeFeedback:G,_handleRegenerate:V,_onTagSelected:L,temporaryMessage:u,showFeedBackForm:E,_parentTheme:U,_childLinkClicked:j,displayColor:P,currentlyStreaming:z,_handleSlotchange:B,_hideFeedBackForm:N,positiveFeedbackSelected:_,negativeFeedbackSelected:S,enableComplexFeedback:W,handlePositiveKeyboardInput:Z,handleNegativeKeyboardInput:Y,compactIcon:M,_feedbackFormValues:K,popupTargetElement:J,_renderLabel:f,customLabels:x,_readerContent:T,previousMessageWidth:X}=g;return n` <div
      class="${i}--chat-message-hidden-label"
      aria-hidden="${!T}"
      role="${T?"alert":"heading"}"
      id="${i}--chat-message-${c}-target-reader-label">
      ${T?n` ${a?n`Message sent, please wait...`:`Message from
      ${e?o||"You":o?o==="watsonx"?"Watson X":o:"Watson X"}
      at ${s}: ${T}`}`:""}
    </div>
    <div
      aria-labelledby="${i}--chat-message-${c}-target-reader-label"
      role="treeitem"
      aria-label="message"
      tabindex="0"
      class="${i}--chat-message ${i}--chat-message-user-message">
      <div class="${i}--chat-message-container">
        ${e?n` <div class="${i}--chat-message-content">
              <div
                class="${i}--chat-message-timestamp-user"
                aria-hidden="true">
                ${o||"You"} ${s}
              </div>
              <div class="${i}--chat-message-response-user">
                <slot
                  name="message-item-content"
                  @slotchange="${B}">
                  ${t.map(r=>n` ${b?n` <clabs-chat-editable-text
                            content="${r.content}"
                            preset-width="${X}"
                            @message-edited="${w}">
                          </clabs-chat-editable-text>`:n`<clabs-chat-text
                            align-right
                            content="${r.content}">
                          </clabs-chat-text>`}`)}
                </slot>
              </div>
              ${p?n` <div
                    class="${i}--chat-message-dropdown-user"></div>`:n` <div class="${i}--chat-message-dropdown-user">
                    ${b===!0?n` <cds-icon-button
                            size="sm"
                            kind="ghost"
                            align="left"
                            label="Undo edit"
                            @click="${$}">
                            ${D({slot:"icon"})}
                            <span slot="tooltip-content"
                              >${f("message-undo-edit")}</span
                            >
                          </cds-icon-button>
                          <cds-icon-button
                            size="sm"
                            kind="ghost"
                            align="left"
                            label="Send edit"
                            @click="${C}">
                            ${A({slot:"icon"})}
                            <span slot="tooltip-content"
                              >${f("message-validate-edit")}</span
                            >
                          </cds-icon-button>`:n` <cds-icon-button
                          size="sm"
                          kind="ghost"
                          align="left"
                          label="Edit Code"
                          @click="${y}">
                          ${I({slot:"icon"})}
                          <span slot="tooltip-content"
                            >${f("message-enable-editing")}</span
                          >
                        </cds-icon-button>`}
                  </div>`}
            </div>`:n` ${M?n``:n`<div class="${i}--chat-message-icon">
                    ${P?n` <div
                          class="${i}--chat-message-agent-icon">
                          ${le()}
                        </div>`:n`
                          <div class="${i}--chat-message-bot-icon">
                            ${U==="white"?n`<svg
                                  aria-hidden="true"
                                  role="presentation"
                                  xmlns="http://www.w3.org/2000/svg"
                                  viewBox="0 0 32 32">
                                  <defs>
                                    <linearGradient
                                      id="ik7o2yqk8a"
                                      x1="1186.526"
                                      y1="2863.168"
                                      x2="1199.825"
                                      y2="2845.109"
                                      gradientTransform="matrix(.8312 .55596 -.27409 .40979 -198.894 -1827.398)"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".3" />
                                      <stop offset="1" stop-opacity="0" />
                                    </linearGradient>
                                    <linearGradient
                                      id="9hg0dg6llb"
                                      x1="1189.388"
                                      y1="2911.794"
                                      x2="1200.478"
                                      y2="2896.735"
                                      gradientTransform="rotate(146.223 380.87 -882.286) scale(1 -.493)"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".3" />
                                      <stop offset=".9" stop-opacity="0" />
                                    </linearGradient>
                                    <linearGradient
                                      id="q1snp4vndc"
                                      x1="-4995.033"
                                      y1="-20162.835"
                                      x2="-4981.733"
                                      y2="-20180.895"
                                      gradientTransform="rotate(-146.223 -971.422 -5714.55) scale(1 .493)"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".32" />
                                      <stop offset=".354" stop-opacity=".798" />
                                      <stop offset=".7" stop-opacity="0" />
                                    </linearGradient>
                                    <linearGradient
                                      id="8ak2l80n4e"
                                      x1="0"
                                      y1="32"
                                      x2="32"
                                      y2="0"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".1" stop-color="#a56eff" />
                                      <stop offset=".9" stop-color="#0f62fe" />
                                    </linearGradient>
                                    <mask
                                      id="eelbk9r8md"
                                      x="0"
                                      y="0"
                                      width="32"
                                      height="32"
                                      maskUnits="userSpaceOnUse">
                                      <path
                                        d="M16 1A14.915 14.915 0 0 0 5.502 5.286l1.4 1.429A12.922 12.922 0 0 1 16 3.001c.977 0 1.929.109 2.845.315-3.402.921-5.916 4.026-5.916 7.715 0 .782.118 1.537.328 2.252a7.978 7.978 0 0 0-2.188-.312c-3.704 0-6.819 2.534-7.726 5.957a12.954 12.954 0 0 1-.345-2.927c0-2.117.492-4.134 1.462-5.996l-1.773-.924A15.037 15.037 0 0 0 .999 16c0 8.271 6.729 15 15 15 3.949 0 7.678-1.522 10.498-4.286l-1.4-1.428A12.926 12.926 0 0 1 15.999 29c-3.648 0-6.945-1.516-9.309-3.945a5.959 5.959 0 0 1-1.621-4.086c0-3.309 2.691-6 6-6a6.006 6.006 0 0 1 5.897 7.107l1.967.367a7.971 7.971 0 0 0-.192-3.726 7.976 7.976 0 0 0 2.187.312c3.71 0 6.829-2.542 7.73-5.974.22.947.34 1.931.34 2.944 0 2.117-.492 4.134-1.462 5.995l1.773.924a15.034 15.034 0 0 0 1.688-6.919C31 7.729 24.272 1 16 1zm4.93 16.03c-3.309 0-6-2.692-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6z"
                                        class="${i}--chat-avatar-element-light-0" />
                                      <path
                                        class="${i}--chat-avatar-element-light-1"
                                        d="M8 9 0 0h16l2.305 3.304L8 9z" />
                                      <path
                                        class="${i}--chat-avatar-element-light-2"
                                        d="m12 31 4.386-9L6 21 2 31h10z" />
                                      <path
                                        class="${i}--chat-avatar-element-light-3"
                                        d="m24 23 8 9H16l-2.304-3.305L24 23z" />
                                      <path
                                        class="${i}--chat-avatar-element-light-4"
                                        d="M16 31h-4.283L15 22h2l-1 9z" />
                                    </mask>
                                  </defs>
                                  <g
                                    class="${i}--chat-avatar-element-light-5">
                                    <path
                                      class="${i}--chat-avatar-element-light-6"
                                      d="M0 0h32v32H0z" />
                                  </g>
                                  <circle
                                    cx="6"
                                    cy="6"
                                    r="2"
                                    class="${i}--chat-avatar-element-light-7" />
                                  <circle
                                    cx="26"
                                    cy="26"
                                    r="2"
                                    class="${i}--chat-avatar-element-light-7" />
                                  <path
                                    d="M16 31c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5zm0-8c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"
                                    class="${i}--chat-avatar-element-light-7" />
                                </svg>`:n`<svg
                                  aria-hidden="true"
                                  role="presentation"
                                  xmlns="http://www.w3.org/2000/svg"
                                  viewBox="0 0 32 32">
                                  <defs>
                                    <linearGradient
                                      id="8913t7g6za"
                                      x1="1196.653"
                                      y1="2930.892"
                                      x2="1209.953"
                                      y2="2912.832"
                                      gradientTransform="matrix(.8312 .55596 -.27409 .40979 -188.767 -1860.755)"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".3" />
                                      <stop offset="1" stop-opacity="0" />
                                    </linearGradient>
                                    <linearGradient
                                      id="woevpxiuib"
                                      x1="1299.261"
                                      y1="2844.072"
                                      x2="1310.351"
                                      y2="2829.012"
                                      gradientTransform="rotate(146.223 440.869 -882.286) scale(1 -.493)"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".3" />
                                      <stop offset=".9" stop-opacity="0" />
                                    </linearGradient>
                                    <linearGradient
                                      id="je2bg9iagc"
                                      x1="-4885.16"
                                      y1="-20230.559"
                                      x2="-4871.86"
                                      y2="-20248.618"
                                      gradientTransform="rotate(-146.223 -911.421 -5714.55) scale(1 .493)"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".32" />
                                      <stop offset=".354" stop-opacity=".798" />
                                      <stop offset=".7" stop-opacity="0" />
                                    </linearGradient>
                                    <linearGradient
                                      id="2co5q30b1e"
                                      x1="0"
                                      y1="32"
                                      x2="32"
                                      y2="0"
                                      gradientUnits="userSpaceOnUse">
                                      <stop offset=".1" stop-color="#be95ff" />
                                      <stop offset=".9" stop-color="#4589ff" />
                                    </linearGradient>
                                    <mask
                                      id="brch21jdod"
                                      x="0"
                                      y="0"
                                      width="32"
                                      height="32"
                                      maskUnits="userSpaceOnUse">
                                      <path
                                        d="M16 1A14.915 14.915 0 0 0 5.502 5.286l1.4 1.429A12.922 12.922 0 0 1 16 3.001c.977 0 1.929.109 2.845.315-3.402.921-5.916 4.026-5.916 7.715 0 .782.118 1.537.328 2.252a7.978 7.978 0 0 0-2.188-.312c-3.704 0-6.819 2.534-7.726 5.957a12.954 12.954 0 0 1-.345-2.927c0-2.117.492-4.134 1.462-5.996l-1.773-.924A15.037 15.037 0 0 0 .999 16c0 8.271 6.729 15 15 15 3.949 0 7.678-1.522 10.498-4.286l-1.4-1.428A12.926 12.926 0 0 1 15.999 29c-3.648 0-6.945-1.516-9.309-3.945a5.959 5.959 0 0 1-1.621-4.086c0-3.309 2.691-6 6-6a6.006 6.006 0 0 1 5.897 7.107l1.967.367a7.971 7.971 0 0 0-.192-3.726 7.976 7.976 0 0 0 2.187.312c3.71 0 6.829-2.542 7.73-5.974.22.947.34 1.931.34 2.944 0 2.117-.492 4.134-1.462 5.995l1.773.924a15.034 15.034 0 0 0 1.688-6.919c0-8.271-6.729-15-15-15zm4.93 16.03c-3.309 0-6-2.692-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6z"
                                        class="${i}--chat-avatar-element-dark-0" />
                                      <path
                                        class="${i}--chat-avatar-element-dark-1"
                                        d="M8 9 0 0h16l2.305 3.305L8 9z" />
                                      <path
                                        class="${i}--chat-avatar-element-dark-2"
                                        d="m12 31 4.386-9L6 21 2 31h10z" />
                                      <path
                                        class="${i}--chat-avatar-element-dark-3"
                                        d="m24 23 8 9H16l-2.305-3.305L24 23z" />
                                      <path
                                        class="${i}--chat-avatar-element-dark-4"
                                        d="M16 31h-4.283L15 22h2l-1 9z" />
                                    </mask>
                                  </defs>
                                  <g
                                    class="${i}--chat-avatar-element-dark-5">
                                    <path
                                      class="${i}--chat-avatar-element-dark-6"
                                      d="M0 0h32v32H0z" />
                                  </g>
                                  <circle
                                    cx="6"
                                    cy="6"
                                    r="2"
                                    class="${i}--chat-avatar-element-dark-7" />
                                  <circle
                                    cx="26"
                                    cy="26"
                                    r="2"
                                    class="${i}--chat-avatar-element-dark-7" />
                                  <path
                                    d="M16 31c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5zm0-8c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"
                                    class="${i}--chat-avatar-element-dark-7" />
                                </svg>`}
                          </div>
                        `}
                  </div> `}
              <div
                class="${i}--chat-message-content ${M?i+"--chat-message-content-compact":""}">
                ${M?n` <div
                      class="${i}--chat-message-header-bot-compact">
                      <div
                        class="${i}--chat-message-bot-icon-compact">
                        ${U==="white"?n`<svg
                              aria-hidden="true"
                              role="presentation"
                              xmlns="http://www.w3.org/2000/svg"
                              viewBox="0 0 32 32">
                              <defs>
                                <linearGradient
                                  id="ik7o2yqk8a"
                                  x1="1186.526"
                                  y1="2863.168"
                                  x2="1199.825"
                                  y2="2845.109"
                                  gradientTransform="matrix(.8312 .55596 -.27409 .40979 -198.894 -1827.398)"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".3" />
                                  <stop offset="1" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient
                                  id="9hg0dg6llb"
                                  x1="1189.388"
                                  y1="2911.794"
                                  x2="1200.478"
                                  y2="2896.735"
                                  gradientTransform="rotate(146.223 380.87 -882.286) scale(1 -.493)"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".3" />
                                  <stop offset=".9" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient
                                  id="q1snp4vndc"
                                  x1="-4995.033"
                                  y1="-20162.835"
                                  x2="-4981.733"
                                  y2="-20180.895"
                                  gradientTransform="rotate(-146.223 -971.422 -5714.55) scale(1 .493)"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".32" />
                                  <stop offset=".354" stop-opacity=".798" />
                                  <stop offset=".7" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient
                                  id="8ak2l80n4e"
                                  x1="0"
                                  y1="32"
                                  x2="32"
                                  y2="0"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".1" stop-color="#a56eff" />
                                  <stop offset=".9" stop-color="#0f62fe" />
                                </linearGradient>
                                <mask
                                  id="eelbk9r8md"
                                  x="0"
                                  y="0"
                                  width="32"
                                  height="32"
                                  maskUnits="userSpaceOnUse">
                                  <path
                                    d="M16 1A14.915 14.915 0 0 0 5.502 5.286l1.4 1.429A12.922 12.922 0 0 1 16 3.001c.977 0 1.929.109 2.845.315-3.402.921-5.916 4.026-5.916 7.715 0 .782.118 1.537.328 2.252a7.978 7.978 0 0 0-2.188-.312c-3.704 0-6.819 2.534-7.726 5.957a12.954 12.954 0 0 1-.345-2.927c0-2.117.492-4.134 1.462-5.996l-1.773-.924A15.037 15.037 0 0 0 .999 16c0 8.271 6.729 15 15 15 3.949 0 7.678-1.522 10.498-4.286l-1.4-1.428A12.926 12.926 0 0 1 15.999 29c-3.648 0-6.945-1.516-9.309-3.945a5.959 5.959 0 0 1-1.621-4.086c0-3.309 2.691-6 6-6a6.006 6.006 0 0 1 5.897 7.107l1.967.367a7.971 7.971 0 0 0-.192-3.726 7.976 7.976 0 0 0 2.187.312c3.71 0 6.829-2.542 7.73-5.974.22.947.34 1.931.34 2.944 0 2.117-.492 4.134-1.462 5.995l1.773.924a15.034 15.034 0 0 0 1.688-6.919C31 7.729 24.272 1 16 1zm4.93 16.03c-3.309 0-6-2.692-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6z"
                                    class="${i}--chat-avatar-element-light-0" />
                                  <path
                                    class="${i}--chat-avatar-element-light-1"
                                    d="M8 9 0 0h16l2.305 3.304L8 9z" />
                                  <path
                                    class="${i}--chat-avatar-element-light-2"
                                    d="m12 31 4.386-9L6 21 2 31h10z" />
                                  <path
                                    class="${i}--chat-avatar-element-light-3"
                                    d="m24 23 8 9H16l-2.304-3.305L24 23z" />
                                  <path
                                    class="${i}--chat-avatar-element-light-4"
                                    d="M16 31h-4.283L15 22h2l-1 9z" />
                                </mask>
                              </defs>
                              <g
                                class="${i}--chat-avatar-element-light-5">
                                <path
                                  class="${i}--chat-avatar-element-light-6"
                                  d="M0 0h32v32H0z" />
                              </g>
                              <circle
                                cx="6"
                                cy="6"
                                r="2"
                                class="${i}--chat-avatar-element-light-7" />
                              <circle
                                cx="26"
                                cy="26"
                                r="2"
                                class="${i}--chat-avatar-element-light-7" />
                              <path
                                d="M16 31c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5zm0-8c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"
                                class="${i}--chat-avatar-element-light-7" />
                            </svg>`:n`<svg
                              aria-hidden="true"
                              role="presentation"
                              xmlns="http://www.w3.org/2000/svg"
                              viewBox="0 0 32 32">
                              <defs>
                                <linearGradient
                                  id="8913t7g6za"
                                  x1="1196.653"
                                  y1="2930.892"
                                  x2="1209.953"
                                  y2="2912.832"
                                  gradientTransform="matrix(.8312 .55596 -.27409 .40979 -188.767 -1860.755)"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".3" />
                                  <stop offset="1" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient
                                  id="woevpxiuib"
                                  x1="1299.261"
                                  y1="2844.072"
                                  x2="1310.351"
                                  y2="2829.012"
                                  gradientTransform="rotate(146.223 440.869 -882.286) scale(1 -.493)"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".3" />
                                  <stop offset=".9" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient
                                  id="je2bg9iagc"
                                  x1="-4885.16"
                                  y1="-20230.559"
                                  x2="-4871.86"
                                  y2="-20248.618"
                                  gradientTransform="rotate(-146.223 -911.421 -5714.55) scale(1 .493)"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".32" />
                                  <stop offset=".354" stop-opacity=".798" />
                                  <stop offset=".7" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient
                                  id="2co5q30b1e"
                                  x1="0"
                                  y1="32"
                                  x2="32"
                                  y2="0"
                                  gradientUnits="userSpaceOnUse">
                                  <stop offset=".1" stop-color="#be95ff" />
                                  <stop offset=".9" stop-color="#4589ff" />
                                </linearGradient>
                                <mask
                                  id="brch21jdod"
                                  x="0"
                                  y="0"
                                  width="32"
                                  height="32"
                                  maskUnits="userSpaceOnUse">
                                  <path
                                    d="M16 1A14.915 14.915 0 0 0 5.502 5.286l1.4 1.429A12.922 12.922 0 0 1 16 3.001c.977 0 1.929.109 2.845.315-3.402.921-5.916 4.026-5.916 7.715 0 .782.118 1.537.328 2.252a7.978 7.978 0 0 0-2.188-.312c-3.704 0-6.819 2.534-7.726 5.957a12.954 12.954 0 0 1-.345-2.927c0-2.117.492-4.134 1.462-5.996l-1.773-.924A15.037 15.037 0 0 0 .999 16c0 8.271 6.729 15 15 15 3.949 0 7.678-1.522 10.498-4.286l-1.4-1.428A12.926 12.926 0 0 1 15.999 29c-3.648 0-6.945-1.516-9.309-3.945a5.959 5.959 0 0 1-1.621-4.086c0-3.309 2.691-6 6-6a6.006 6.006 0 0 1 5.897 7.107l1.967.367a7.971 7.971 0 0 0-.192-3.726 7.976 7.976 0 0 0 2.187.312c3.71 0 6.829-2.542 7.73-5.974.22.947.34 1.931.34 2.944 0 2.117-.492 4.134-1.462 5.995l1.773.924a15.034 15.034 0 0 0 1.688-6.919c0-8.271-6.729-15-15-15zm4.93 16.03c-3.309 0-6-2.692-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6z"
                                    class="${i}--chat-avatar-element-dark-0" />
                                  <path
                                    class="${i}--chat-avatar-element-dark-1"
                                    d="M8 9 0 0h16l2.305 3.305L8 9z" />
                                  <path
                                    class="${i}--chat-avatar-element-dark-2"
                                    d="m12 31 4.386-9L6 21 2 31h10z" />
                                  <path
                                    class="${i}--chat-avatar-element-dark-3"
                                    d="m24 23 8 9H16l-2.305-3.305L24 23z" />
                                  <path
                                    class="${i}--chat-avatar-element-dark-4"
                                    d="M16 31h-4.283L15 22h2l-1 9z" />
                                </mask>
                              </defs>
                              <g
                                class="${i}--chat-avatar-element-dark-5">
                                <path
                                  class="${i}--chat-avatar-element-dark-6"
                                  d="M0 0h32v32H0z" />
                              </g>
                              <circle
                                cx="6"
                                cy="6"
                                r="2"
                                class="${i}--chat-avatar-element-dark-7" />
                              <circle
                                cx="26"
                                cy="26"
                                r="2"
                                class="${i}--chat-avatar-element-dark-7" />
                              <path
                                d="M16 31c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5zm0-8c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"
                                class="${i}--chat-avatar-element-dark-7" />
                            </svg>`}
                      </div>
                      <div
                        class="${i}--chat-message-timestamp-bot-compact"
                        id="message${c}-origin">
                        ${o??"watsonx"}
                        ${s}
                      </div>
                    </div>`:n` <div
                      class="${i}--chat-message-timestamp-bot"
                      aria-hidden="true">
                      ${o??"watsonx"}
                      ${s}
                    </div>`}

                <div
                  class="${i}--chat-message-response-bot ${z?i+"--chat-message-streaming":""}">
                  <slot
                    name="message-item-content"
                    @slotchange="${B}">
                    ${t.map(r=>n`
                        ${r.type==="img"?n`
                              <clabs-chat-image content="${r.content}">
                              </clabs-chat-image>
                            `:r.type==="chart"?n`
                              <clabs-chat-chart
                                content="${r.content}"
                                container-height="320px">
                              </clabs-chat-chart>
                            `:r.type==="link-list"?n`
                              <clabs-chat-link-list
                                @on-link-list-item-selected="${j}"
                                .customLabels="${x}"
                                content="${r.content}">
                              </clabs-chat-link-list>
                            `:r.type==="carousel"?n`
                              <clabs-chat-carousel content="${r.content}">
                              </clabs-chat-carousel>
                            `:r.type==="molecule"?n`
                              <clabs-chat-molecule
                                height="${369}"
                                content="${r.content}">
                              </clabs-chat-molecule>
                            `:r.type==="formula"?n`
                              <clabs-chat-formula content="${r.content}">
                              </clabs-chat-formula>
                            `:r.type==="file-upload"?n`
                              <clabs-chat-file-upload
                                content="${r.content}">
                              </clabs-chat-file-upload>
                            `:r.type==="table"?n`
                              <clabs-chat-table
                                max-height="246px"
                                content="${r.content}">
                              </clabs-chat-table>
                            `:r.type==="url"||r.type==="video"||r.type==="file"||r.type==="audio"?n`
                              <clabs-chat-card
                                type="${r.type}"
                                content="${r.content}">
                              </clabs-chat-card>
                            `:r.type==="card"?n`
                              <clabs-chat-card content="${r.content}">
                              </clabs-chat-card>
                            `:r.type==="text"?n`
                              <clabs-chat-text
                                capitalize
                                content="${r.content}">
                              </clabs-chat-text>
                            `:r.type==="annotated-text"?n`
                              <clabs-chat-text
                                capitalize
                                enable-annotations
                                content="${r.content}">
                              </clabs-chat-text>
                            `:r.type==="highlight-text"?n`
                              <clabs-chat-text
                                enable-text-highlighting
                                content="${r.content}">
                              </clabs-chat-text>
                            `:r.type==="summarized-text"?n`
                              <clabs-chat-text
                                enable-summarization
                                content="${r.content}">
                              </clabs-chat-text>
                            `:r.type==="html-text"?n`
                              <clabs-chat-text
                                capitalize
                                enable-html-rendering
                                content="${r.content}">
                              </clabs-chat-text>
                            `:r.type==="diagram"?n` <clabs-chat-diagram
                              definition="${r.content}">
                            </clabs-chat-diagram>`:r.type==="list"?n`
                              <clabs-chat-list content="${r.content}">
                              </clabs-chat-list>
                            `:r.type==="loading"?n` <clabs-chat-loading> </clabs-chat-loading> `:r.type==="code"?n`
                              <clabs-chat-code
                                content="${r.content}"
                                .customLabels="${x}"
                                max-height="246px">
                              </clabs-chat-code>
                            `:r.type==="editable-code"?n`
                              <clabs-chat-code
                                content="${r.content}"
                                .customLabels="${x}"
                                editable
                                max-height="369px">
                              </clabs-chat-code>
                            `:r.type==="tags"?n`
                              <clabs-chat-tag-list
                                content="${r.content}"
                                @tag-selected="${L}">
                              </clabs-chat-tag-list>
                            `:r.type==="error"?n`
                              <clabs-chat-error
                                content="${r.content}"
                                capitalize>
                              </clabs-chat-error>
                            `:n`
                            <p class="${i}--chat-message-warning">
                              [Warning] No valid block-type specified, rendering as type 'text': 
                            </p>
                            <clabs-chat-text
                              capitalize
                              content="${r.content}">
                            </clabs-chat-text>
                          </div>`}
                      `)}
                  </slot>
                  ${z?n`
                        ${u.type==="table"?n`
                              <clabs-chat-table
                                max-height="246px"
                                content="${u.content}">
                              </clabs-chat-table>
                            `:u.type==="list"?n`
                              <clabs-chat-list
                                content="${u.content}">
                              </clabs-chat-list>
                            `:u.type==="code"?n`
                              <clabs-chat-code
                                streaming
                                .customLabels="${x}"
                                content="${u.content}">
                              </clabs-chat-code>
                            `:u.type==="chart"?n`
                              <clabs-chat-chart
                                ?streaming="${!0}"
                                content="${u.content}">
                              </clabs-chat-chart>
                            `:u.type==="carousel"?n`
                              <clabs-chat-carousel
                                content="${u.content}">
                              </clabs-chat-carousel>
                            `:u.type==="molecule"?n`
                              <clabs-chat-molecule
                                streaming
                                height="${369}"
                                content="${u.content}">
                              </clabs-chat-molecule>
                            `:u.type==="formula"?n`
                              <clabs-chat-formula
                                content="${u.content}">
                              </clabs-chat-formula>
                            `:u.type==="tags"?n`
                              <clabs-chat-tag-list
                                content="${u.content}"
                                @tag-selected="${L}">
                              </clabs-chat-tag-list>
                            `:n`
                              <clabs-chat-text
                                streaming
                                content="${u.content}">
                              </clabs-chat-text>
                            `}
                      `:n``}
                </div>

                ${!a&&!p&&!z?n`
                      <div class="${i}--chat-message-dropdown-bot">
                        ${e?b===!0?n` <cds-icon-button
                                  size="sm"
                                  kind="ghost"
                                  align="left"
                                  label="Undo Edit"
                                  @click="${$}">
                                  ${D({slot:"icon"})}
                                  <span slot="tooltip-content"
                                    >${f("message-undo-edit")}</span
                                  >
                                </cds-icon-button>
                                <cds-icon-button
                                  size="sm"
                                  kind="ghost"
                                  align="left"
                                  label="Send edit"
                                  @click="${C}">
                                  ${A({slot:"icon"})}
                                  <span slot="tooltip-content"
                                    >${f("message-validate-edit")}</span
                                  >
                                </cds-icon-button>`:n` <cds-icon-button
                                size="sm"
                                kind="ghost"
                                align="left"
                                label="Edit message"
                                @click="${y}">
                                ${I({slot:"icon"})}
                                <span slot="tooltip-content"
                                  >${f("message-enable-editing")}</span
                                >
                              </cds-icon-button>`:n`
                              <cds-icon-button
                                size="sm"
                                kind="ghost"
                                align="right"
                                role="button"
                                aria-expanded="${_}"
                                aria-controls="${E?i+"--chat-popup-unique-feedback-"+c:""}"
                                @keydown="${Z}"
                                @click="${q}">
                                ${_?oe({slot:"icon"}):ne({slot:"icon"})}
                                <span slot="tooltip-content"
                                  >${f(_?"message-undo-like-button":"message-like-button")}</span
                                >
                              </cds-icon-button>

                              <cds-icon-button
                                size="sm"
                                kind="ghost"
                                align="right"
                                role="button"
                                aria-expanded="${S}"
                                aria-controls="${E?i+"--chat-popup-unique-feedback-"+c:""}"
                                label="Thumbs down"
                                @keydown="${Y}"
                                @click="${G}">
                                ${S?re({slot:"icon"}):ce({slot:"icon"})}
                                <span slot="tooltip-content"
                                  >${f(S?"message-undo-dislike-button":"message-dislike-button")}</span
                                >
                              </cds-icon-button>
                              <cds-icon-button
                                size="sm"
                                kind="ghost"
                                align="right"
                                label="Regenerate"
                                @click="${V}">
                                ${se({slot:"icon"})}
                                <span slot="tooltip-content"
                                  >${f("message-regenerate-button")}</span
                                >
                              </cds-icon-button>
                            `}
                      </div>
                    `:n`<div
                      class="${i}--chat-message-dropdown-bot"></div>`}
              </div>`}
      </div>
      ${E||W?n`
            <clabs-chat-popup
              @on-feedback-popup-closed="${N}"
              ?is-open="${E}"
              id="${i}--chat-popup-unique-feedback-${c}"
              .feedbackFormValues="${K}"
              .targetElement="${J}"
              .customLabels="${x}"
              parent-message-id="${c}"
              ?compact-mode="${M}"
              type="${_?"thumbs-up":S?"thumbs-down":"custom"}">
            </clabs-chat-popup>
          `:n``}
    </div>`}var pe=Object.defineProperty,de=Object.getOwnPropertyDescriptor,me=(g,t,e,s)=>{for(var a=s>1?void 0:s?de(t,e):t,c=g.length-1,o;c>=0;c--)(o=g[c])&&(a=(s?o(t,e,a):o(a))||a);return s&&a&&pe(t,e,a),a};const{stablePrefix:ge}=R;let O=class extends l{render(){return he(this)}};O=me([Q(`${ge}-chat-message`)],O);
